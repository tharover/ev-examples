<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Engineering Village API example - charting</title>

    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>

</head>

<body>
    <h1>Example of charting data using EV Search API</h1>
    <p>Please enter your API key: <input type="text" name="apikey_input" id="apikey_input"></p>
    <p>Please enter your API insttoken (if required): <input type="text" name="apikey_input" id="apikey_input"></p>
    <p><button id="go">Go</button></p>
    <div id="container" style="height: 400px; min-width: 600px; max-width: 800px; margin: 0 auto"><span
            style="color:#c0c0c0; font-style: italic">Graph displays here...</span></div>

    <script>
        // Create chart data
        var chartData = {
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false,
                type: 'pie'
            },
            title: {
                text: ''
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: true
                    },
                    showInLegend: false
                }
            },
            series: [{
                name: 'Document types',
                colorByPoint: true,
                data: []
            }]
        };


        //
        // Clicking the "Go" button will attempt to render a graph of the document types for a query
        //
        var query = "(({Electrical engineering}) WN MH)"; // Any valid expert search syntax
        $("#go").click(function () {

            // Run search using EV API
            $.ajax({
                    dataType: "json", // Request JSONP from EV API
                    method: "GET", // Plain old GET request
                    // EV Search API request URL - pass query, API key and databases to search
                    url: "https://api.elsevier.com/content/ev/results?sortField=relevance&database=c&navigator=trueapiKey=" +
                        $("#apikey_input").text() +
                        "&insttoken=" +
                        $("#apikey_input").text() +
                        "&query=" +
                        encodeURIComponent(query)
                })
                // Handle unsuccessful call
                .fail(function (jqXHR, textStatus, errorThrown) {
                    $("#container").html("<b>ERROR<b> - request failed (" + jqXHR.status + " - " + jqXHR.state() + ").  ");
                })

                // Handle successful call
                .done(function (data) {
                    // Set chart title
                    chartData.title.text = "" + data.PAGE["RESULTS-COUNT"] +
                        " results found in <b>Compendex</b> for '" + query + "'";
                    // Extract Document type navigator values from JSON response
                    var nav = null;
                    var i = 0;
                    for (; i < data.PAGE.NAVIGATORS.NAVIGATOR.length; i++) {
                        if (data.PAGE.NAVIGATORS.NAVIGATOR[i].FIELD == "dt") {
                            nav = data.PAGE.NAVIGATORS.NAVIGATOR[i]; // Found Document type, exit
                            break;
                        }
                    }
                    // If we found Document type navigator
                    if (nav != null) {
                        for (i = 0; i < nav.MODIFIER.length; i++) {
                            chartData.series[0].data.push({
                                name: nav.MODIFIER[i].LABEL,
                                y: Number(nav.MODIFIER[i].COUNT)
                            });
                        }
                    };

                    Highcharts.chart('container', chartData);
                });
        });
    </script>
</body>

</html>